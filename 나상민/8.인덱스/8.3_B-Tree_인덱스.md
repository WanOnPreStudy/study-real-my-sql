# 8.3 B-Tree 인덱스

1. B-Tree는 데이터베이스의 인덱싱 알고리즘 가운데 가장 일반적으로 사용된다.
2. B-Tree는 칼럼의 원래 값을 변형시키지 않고 인덱스 구조체 내에서는 항상 정렬된 상태로 유지한다.

## 8.3.1 구조 및 특성

1. 최상위에 하나의 `루트노드`와 중간의 `브랜치노드`, 최하위에 `리프노드`가 존재한다.
2. 데이터베이스에서 인덱스와 실제 데이터가 저장된 데이터는 따로 관리되는데, 인덱스의 리프노드는 항상 실제 데이터 레코드를 찾아가기 위한 주솟값을 가지고 있다.
3. 인덱스의 키 값은 모두 정렬돼 있지만, 데이터 파일의 레코드는 정렬돼 있지 않고 임의의 순서로 저장돼 있다.
4. InnoDB 스토리지 엔진에서는 모든 세컨더리 인덱스 검색에서 데이터 레코드를 읽기 위해서는 반드시 프라이머리 키를 저장하고 있는 B-Tree 를 다시 한번 검색해야 한다.

## 8.3.2 B-Tree 인덱스 키 추가 및 삭제

### 8.3.2.1 인덱스 키 추가

1. B-Tree에 새로운 키가 저장될 때 B-Tree상의 적절한 위치를 검색한다.
2. 저장될 위치가 결정되면 레코드의 값과 대상 레코드의 주소정보를 B-Tree의 리프 노드에 저장한다.
3. 리프노드가 꽉 차서 더는 저장 할 수 없을 때는 리프노드가 상위 브랜치 노드까지 분리된다.(많은 비용이 듬)

### 8.3.2.2 인덱스 키 삭제

1. 해당 키 값이 저장된 B-Tree의 리프 노드를 찾아서 그냥 삭제 마크만 하면 작업이 완료된다.
2. 이렇게 삭제 마킹된 인덱스 키 공간은 그대로 방치하거나 재활용할 수 있다.

### 8.3.2.3 인덱스 키 변경

1. 인덱스 키 값이 변경될 때, 단순히 인덱스 값만 변경하는 것은 불가능하다.
2. 기존의 키값을 삭제하고, 다시 새로운 키 값을 추가하는 형태로 처리된다.

### 8.3.2.4 인덱스 키 검색

1. Insert, Update, Delete 작업을 할 때 추가 비용을 감당하면서 인덱스를 구축하는 이유는 바로 빠른 검색을 위해서다.
2. B-Tree 인덱스를 이용한 검색은 100% 일치 또는 값의 앞부분만 일치하는 경우에 사용할 수 있다.
3. 인덱스의 키값에 변형이 가해진 후 비교되는 경우에는 절대 B-Tree이 빠른 검색 기능을 사용핳 수 없다.
4. InnoDB 테이블에서 지원하는 레코드 잠금이나 넥스트 키락이 검색을 수행한 인덱스를 잠근 후 테이블의 레코드를 잠그는 방식으로 구현돼 있다.따라서, UPDATE나 DELETE 문장이 실행될 때 테이블에 적절히
   사용할 수 있는 인덱스가 없으면 불필요하게 많은 레코드를 잠근다.